# 第１回：データバインディング

## はじめに

最近のWebアプリケーションではリッチなUIが求められており、 PCだけでなくスマフォやタブレット対応も必要になり開発は複雑化しています。

また、端末のパフォーマンス向上やブラウザ機能の向上によりJavaScriptで実現できることも大きく広がっています。

そのため、 複雑で大規模なクライアントサイドを開発するためにJavaScriptにもフレームワークが必要になってきています。

そこで2014年現在、クライアントサイドの３大フレームワークの１つである「AngularJS」について、私自身の学習も兼ねて一緒に学んでいけたらなと思います。

ちなみに３大MVCフレームワークは、AngularJS, Backbone.js, Knockout.js です。

## jQueryは？

jQueryはフレームワークというよりは、DOM操作を容易にするためのライブラリです。
jQueryを使用する際には以下の２ステップを踏む必要があります。

1. 動的に書き変えたい部分にCSSを適用する（#id, .class）
2. JavaScriptでCSSセレクタを使って、書き換えた部分を選択しDOMを書き換える。

```js   
$('#list').append('&lt;li>Hello&lt;/li>');
```   

これらのステップにより簡単に動的にコンテンツを書き換えることが出来ますが、以下のデメリットが存在します。

1. デザイン以外のCSSを適用しなければならなくなり、CSSが増えて何がなんだかわからなくなる。
2. デザインを変更すると、JavaScript部分に影響するかもしれない。
   上記の例のように #list だけであれば問題ありませんが 対象要素の祖先とか孫とかを検索してたりするとアウトです。
3. JavaScriptのロジック部分に、DOM操作のコードが含まれるため単体テストが出来なかったり、
   コードの再利用が難しい。

## AngularJS（アンギュラージェイエス）について

AngularJSの特徴として、以下をあげます。

* Google社が開発したJavaScriptのMVCフレームワーク
* 一番の特徴は「双方向データバインディング」
* フルスタック
* 学習コストが高い

### 「双方向データバインディング」がかなりヤバイ！

これがかなりヤバすぎて、一目惚れしてしましました。
双方向とは、JavaScript→UI、UI→JavaScriptを指します。
つまりは

* JavaScriptのモデル（変数）への変更がUIに自動的に反映される
* UIの入力内容がJavaScriptのモデル（変数）に自動的に反映される

です。後でサンプルを紹介します。

### フルスタックである

これはクライアントサイドで必要となる機能がひと通り揃っていることを
指します。実際、双方向データバインディングで処理されているDOMの
書き換え部分では、簡易版のjQuery（jqLite）も含まれています。

`jqLiteでは、最小限のjQueryのメソッドをバンドルしたものです。AngularJSの前に本物のjQueryが読み込まれていると、jqLiteではなくjQueryが使われるようになります。`

### 学習コストが高い

良いこと尽くしのAngularJSですが、独自概念が多く存在するため
学習コストが高いですが、費用対効果は悪くないと思います。

実際に、私は「かん助」の既存画面の一部のUIと「eGov」プロジェクトの
IT用API実行ツールの作成に利用しましたが、ある程度基本を抑えれば 実業務でフルでも部分的でも導入可能と判断しました。

※独自概念とはスコープ、モジュール、サービス、フィルター、ディレクティブなど


# サンプル紹介

今回はごく簡単なサンプルだけとし、次回以降、独自概念の説明や
コントローラを使った開発例を紹介したいと思います。

まずは、サンプルタブにあるテキストボックスに何か入力してみてください。

どうだったでしょうか？
私はこれを見た時に衝撃を受けました。

サンプルのHTMLは以下のようになっています。


```index.html
&lt;!DOCTYPE html>
&lt;html lang="ja" ng-app>
&lt;head>
&lt;script src="js/angular.min.js">&lt;/script>
&lt;/head>
&lt;body>
&lt;p>テキストボックスに何か入力してみてください&lt;/p>
&lt;input type="text" ng-model="msg">
&lt;p>入力した値：{{msg}}&lt;/p>
&lt;p>エクスプレッションでの計算結果：{{1 + 1}}&lt;/p>
&lt;p>入力した値の length == 3：{{msg.length == 3}}&lt;/p>
&lt;/body>
&lt;/html>
```


それでは、詳しく解説していきたいと思います。

## 準備

まず必要なのが、04行目のAngularJSのスクリプトの読み込みです。__
[公式サイト](https://angularjs.org/)
よりダウンロードするか、GoogleのCDNを読みこませればOKです。

CDN
https://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js

ちなみに、1.2.x系と1.3.x系が平行して開発が進められており、
1.3.x系ではIE8はサポートされませんので、IE8で動作させたい場合は
1.2.xを使うとよいでしょう。
これから先、私が発信する自由情報では、1.2.x系を使っていきます。

次に02行目でこのHTMLがAngularJSのアプリケーションであることを
示す _ng-app_ を付与します。
_ng-XXX_ は、A ng ularJSの"ng"です。これらは「ビルトインディレクティブ」
と言い、独自概念のうちの１つである「ディレクティブ」を表します。

これから先 _ng-XXX_ をたくさん紹介していきますが、とりあえず標準で用意されている
ディレクティブということだけ覚えておいてください。

_ng-app_ は、AngularJSの適用範囲とロードするモジュールを示すディレクティブです。  
今回は、HTMLタグ以下を適用範囲として指定しています。モジュールについては、次回以降説明します。  
部分的にAngularJSを適用したい場合は、divタグなどに付与すればOKです。

## モデル定義

08行目では、_ng-model_ というビルトインディレクティブを使っています。  
これは、このテキストボックス要素の値をモデルとして、変数msgに
バインディングすることを表しています。  
これにより、テキストボックスに入力した内容がモデル変数msgに
反映されます。

## テンプレートエンジン

AngularJSはHTMLベースのテンプレートエンジンを採用しており、
条件分岐や繰り返しの制御構造もHTMLの文法に準拠したディレクティブを
カスタムタグやカスタム属性として利用します。

そして特殊ですが「**{{**」と「**}}**」で囲まれた部分を**エクスプレッション**と言い
エクスプレッションには変数や簡単なロジックを記載することができます。

09行目では、モデル変数msgの内容を表示しています。  
これにより、テキストボックスに入力された値がインタラクティブに
モデル変数に反映され、そして{{msg}}の部分に表示されます。
これが、双方向バインディングと呼ばれるものです。

* テキストボックス（UI）  → msgモデル（変数）
* エクスプレッション（UI）← msgモデル（変数）

また、10行目,11行目により簡単な式や条件判定も記載できることが
分かっていただけると思います。

この他にも、エクスプレッションには「フィルター」というものを
適用できたりするのですが、これについては次回以降説明したいと
思います。

今回は、AngularJSを使って入力した値をダイナミックに表示させる方法に
ついて紹介しました。
