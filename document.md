自由情報12: AngularJS入門始めます
=================================

# はじめに

最近のWebアプリケーションではリッチなUIが求められており、
PCだけでなくスマフォやタブレット対応も必要になり
開発は複雑化しています。

また、端末のパフォーマンス向上やブラウザ機能の向上により
JavaScriptで実現できることも大きく広がっています。

そのため、 複雑で大規模なクライアントサイドを開発するために
JavaScriptにもフレームワークが必要になってきています。

そこで2014年現在、クライアントサイドの３大フレームワークの
１つである「AngularJS」について、私自身の学習も兼ねて
一緒に学んでいけたらなと思います。

ちなみに３大MVCフレームワークは、AngularJS, Backbone.js,
Knockout.js です。

## jQueryは？

jQueryはフレームワークというよりは、DOM操作を容易にするための
ライブラリです。
jQueryを使用する際には以下の２ステップを踏む必要があります。

1. 動的に書き変えたい部分にCSSを適用する（#id, .class）
2. JavaScriptでCSSセレクタを使って、書き換えた部分を選択し
   DOMを書き換える。
   $('#list').append('<li>Hello</li>');

これらのステップにより簡単に動的にコンテンツを書き換えることが
出来ますが、以下のデメリットが存在します。

1. デザイン以外のCSSを適用しなければならなくなり、CSSが増えて
   何がなんだかわからなくなる。
2. デザインを変更すると、JavaScript部分に影響するかもしれない。
   上記の例のように #list だけであれば問題ありませんが
   対象要素の祖先とか孫とかを検索してたりするとアウトです。
3. JavaScriptのロジック部分に、DOM操作のコードが含まれるため
   単体テストが出来なかったり、コードの再利用が難しい。


# AngularJS（アンギュラージェイエス）について

AngularJSの特徴として、以下をあげます。

* Google社が開発したJavaScriptのMVCフレームワーク
* 一番の特徴は「双方向データバインディング」
* フルスタック
* 学習コストが高い

## 「双方向データバインディング」がかなりヤバイ！

これがかなりヤバすぎて、一目惚れしてしましました。
双方向とは、JavaScript→UI、UI→JavaScriptを指します。
つまりは

* JavaScriptのモデル（変数）への変更がUIに自動的に反映される
* UIの入力内容がJavaScriptのモデル（変数）に自動的に反映される

です。後でサンプルを紹介します。

## フルスタックである

これはクライアントサイドで必要となる機能がひと通り揃っていることを
指します。実際、双方向データバインディングで処理されているDOMの
書き換え部分では、簡易版のjQuery（jqLite）も含まれています。
※jqLiteでは、最小限のjQueryのメソッドをバンドルしたものです。
  AngularJSの前に本物のjQueryが読み込まれていると、jqLiteではなく
  jQueryが使われるようになります。

## 学習コストが高い

良いこと尽くしのAngularJSですが、独自概念が多く存在するため
学習コストが高いですが、費用対効果は悪くないと思います。

実際に、私は「かん助」の既存画面の一部のUIと「eGov」プロジェクトの
IT用API実行ツールの作成に利用しましたが、ある程度基本を抑えれば 実業務でフルでも部分的でも導入可能と判断しました。

※独自概念とは
  スコープ、モジュール、サービス、フィルター、ディレクティブなど


# サンプル紹介

今回はごく簡単なサンプルだけとし、次回以降、独自概念の説明や
コントローラを使った開発例を紹介したいと思います。

まずは、以下にアクセスしてテキストボックスに何か入力してみてください。
https://dl.dropboxusercontent.com/u/20186684/jiyu/12/index.html

どうだったでしょうか？
私はこれを見た時に衝撃を受けました。

上記サイトのHTMLは以下のようになっています。

```index.html
01 <!DOCTYPE html>
02 <html lang="ja" ng-app>
03 <head>
04 	<meta charset="UTF-8">
05 	<title>AngularJS入門</title>
06 	<script src="js/angular.min.js"></script>
07 </head>
08 <body>
09 <h1>AngularJS入門</h1>
10 <h2>第１回：データバインディング</h2>
11 
12 <input type="text" ng-model="msg">
13 <p>{{msg}}</p>
14 <p>{{1 + 1}}</p>
15 <p>{{msg.length == 3}}</p>
16 
17 </body>
18 </html>
```

それでは、詳しく解説していきたいと思います。

## 準備

まず必要なのが、06行目のAngularJSのスクリプトの読み込みです。
[公式サイト](https://angularjs.org/)
よりダウンロードするか、GoogleのCDNを読みこませればOKです。

CDN
https://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js

ちなみに、1.2.x系と1.3.x系が平行して開発が進められており、
1.3.x系ではIE8はサポートされませんので、IE8で動作させたい場合は
1.2.xを使うとよいでしょう。
これから先、私が発信する自由情報では、1.2.x系を使っていきます。

次に02行目でこのHTMLがAngularJSのアプリケーションであることを
示す "ng-app" を付与します。

"ng-XXX"は、A ng ularJSの"ng"です。これらは「ビルトインティレクティブ」
と言い、独自概念のうちの１つである「ディレクティブ」を表します。

これから先"ng-XXX"をいっぱい紹介していきますが、今回は標準で用意されている
ディレクティブということだけ覚えておいてください。

ng-appは、AngularJSの適用範囲とロードするモジュールを示すディレクティブです。
今回は、htmlタグ以下を適用範囲として指定しています。
モジュールについては、次回以降説明します。
部分的にAngularJSを適用したい場合は、divタグなどに付与すればOKです。

## モデル定義

12行目では、"ng-model"というビルトインディレクティブを使っています。
これは、このテキストボックス要素の値をモデルとして、変数msgに
バインディングすることを表しています。
これにより、テキストボックスに入力した内容がモデル変数msgに
反映されます。

## テンプレートエンジン

AngularJSはHTMLベースのテンプレートエンジンを採用しており、
条件分岐や繰り返しの制御構造もHTMLの文法に準拠したカスタムタグや
カスタム属性として利用します。そして特殊ですが「{{」と「}}」で
囲まれた部分をエクスプレッションと言い、エクスプレッションには
変数や簡単なロジックを記載することができます。

13行目では、モデル変数msgの内容を表示しています。
これにより、テキストボックスに入力された値がインタラクティブに
モデル変数に反映され、そして{{msg}}の部分に表示されます。
これが、双方向バインディングと呼ばれるものです。

  テキストボックス（UI）  → msgモデル（変数）
  エクスプレッション（UI）← msgモデル（変数）

また、14行目,15行目により簡単な式や条件判定も記載できることが
分かっていただけると思います。

この他にも、エクスプレッションには「フィルター」というものを
適用できたりするのですが、これについては次回説明したいと
思います。

今回は、AngularJSを使って入力した値をダイナミックに表示させる方法に
ついて紹介しました。

